<?php
session_start();
include 'cfg/dbconnect.php';

// SQL queries
$reportsSql = "SELECT id, location, type, details, created_at, status FROM emergency_reports ORDER BY created_at DESC";
$smsSql     = "SELECT id, number, message, status FROM sms_alert ORDER BY id DESC";

$reports = $conn->query($reportsSql);
$sms     = $conn->query($smsSql);
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Alerts History</title>
  <style>
    .dashboard-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    .dashboard-content table th,
    .dashboard-content table td {
      border: 1px solid #ccc;
      padding: 0.75rem;
      text-align: left;
    }
    .dashboard-content table th {
      background-color: #ecf0f1;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="dashboard-content">
    <h2>üì• My Alerts History</h2>

    <h3>Emergency Reports</h3>
    <table>
      <thead>
        <tr>
          <th>#</th><th>Location</th><th>Type</th>
          <th>Description</th><th>Date</th><th>Status</th>
        </tr>
      </thead>
      <tbody>
        <?php if ($reports && $reports->num_rows): ?>
          <?php while ($r = $reports->fetch_assoc()): ?>
          <tr>
            <td><?= htmlspecialchars($r['id']) ?></td>
            <td><?= htmlspecialchars($r['location']) ?></td>
            <td><?= htmlspecialchars(str_replace('_',' ',$r['type'])) ?></td>
            <td><?= htmlspecialchars($r['details']) ?></td>
            <td><?= htmlspecialchars($r['created_at']) ?></td>
            <td><?= htmlspecialchars($r['status']) ?></td>
          </tr>
          <?php endwhile; ?>
        <?php else: ?>
          <tr><td colspan="6" style="text-align:center;">No reports found.</td></tr>
        <?php endif; ?>
      </tbody>
    </table>

    <h3>SMS Alerts</h3>
    <table>
      <thead>
        <tr>
          <th>#</th><th>Number</th><th>Message</th><th>Status</th>
        </tr>
      </thead>
      <tbody>
        <?php if ($sms && $sms->num_rows): ?>
          <?php while ($s = $sms->fetch_assoc()): ?>
          <tr>
            <td><?= htmlspecialchars($s['id']) ?></td>
            <td><?= htmlspecialchars($s['number']) ?></td>
            <td><?= htmlspecialchars($s['message']) ?></td>
            <td><?= htmlspecialchars($s['status']) ?></td>
          </tr>
          <?php endwhile; ?>
        <?php else: ?>
          <tr><td colspan="4" style="text-align:center;">No SMS alerts found.</td></tr>
        <?php endif; ?>
      </tbody>
    </table>

    <div style="text-align:center; margin-top:1rem;">
      <button onclick="history.back()">‚¨ÖÔ∏è Back</button>
    </div>
  </div>
</body>
</html>
